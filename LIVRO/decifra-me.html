<!DOCTYPE html>
<head>
    <title>EBJN - Decifra-me</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/index">
    <link rel="stylesheet" href="/css/livro">
    <link rel="manifest" href="/manifest">
    <script src="https://kit.fontawesome.com/e77c01ed94.js" crossorigin="anonymous"></script>
</head>
<html lang="pt-br">
    <body>
        <nav>
            <button class="voltar" onclick="history.back()"><i class="fa-solid fa-arrow-left"></i></button>
            <h1>EBJN</h1>
        </nav>
        <div id='flipbook'>
            <div><img class='page' src='/PAGES/decifra-me/1.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/2.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/3.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/4.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/5.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/6.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/7.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/8.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/9.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/10.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/11.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/12.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/13.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/14.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/15.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/16.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/17.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/18.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/19.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/20.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/21.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/22.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/23.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/24.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/25.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/26.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/27.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/28.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/29.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/30.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/31.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/32.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/33.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/34.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/35.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/36.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/37.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/38.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/39.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/40.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/41.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/42.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/43.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/44.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/45.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/46.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/47.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/48.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/49.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/50.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/51.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/52.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/53.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/54.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/55.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/56.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/57.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/58.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/59.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/60.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/61.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/62.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/63.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/64.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/65.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/66.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/67.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/68.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/69.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/70.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/71.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/72.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/73.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/74.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/75.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/76.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/77.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/78.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/79.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/80.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/81.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/82.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/83.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/84.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/85.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/86.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/87.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/88.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/89.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/90.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/91.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/92.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/93.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/94.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/95.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/96.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/97.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/98.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/99.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/100.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/101.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/102.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/103.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/104.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/105.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/106.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/107.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/108.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/109.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/110.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/111.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/112.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/113.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/114.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/115.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/116.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/117.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/118.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/119.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/120.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/121.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/122.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/123.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/124.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/125.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/126.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/127.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/128.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/129.jpg'></div>
            <div><img class='page' src='/PAGES/decifra-me/130.jpg'></div>
         </div>
    </body>
</html>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="/js/turn"></script>
<script src="/js/book"></script>
<script>
    function getMultiValueCookie(name) {
    const cookieArray = document.cookie.split(', ');
    for (let i = 0; i < cookieArray.length; i++) {
        const cookie = cookieArray[i].split('=');
        if (cookie[0] === name) {
            return cookie[1].split(',');
        }
    }
    return null;
    }
    const user = getMultiValueCookie("username");
    if(user) {
        const id = user[0];
        const query = {
            operation: 'read-get',
            id: id,
            placeholder: 'decifra-me'
        };
        console.log("Fazendo fetch");
        fetch('/user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(query)
        }).then(response => response.json())
            .then(page => {
                console.log(page);
                if(page.page.length != 0) {
                    $("#flipbook").turn("page", page.page[0].page);
                }
        }).catch(error => console.error(error));
        let oldPage = $("#flipbook").turn("page");
        setInterval(() => {
            let actualPage = $("#flipbook").turn("page");
            if(actualPage != oldPage) {
                const data = {
                    operation: "read-update",
                    id: id,
                    pageNumber: actualPage,
                    placeholder: "decifra-me"
                };
                fetch('/user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                }).catch(error => console.error(error));
                oldPage = actualPage;
            }
        }, 3000);
    }
</script>